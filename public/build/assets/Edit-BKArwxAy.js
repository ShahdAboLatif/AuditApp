import{j as e,H as h,r as n,a as D}from"./app-rOyHO9Rd.js";import{A as b}from"./app-layout-INM8-aEI.js";import"./app-KQAryUus.js";import"./app-logo-icon-yZ7-xYF8.js";import"./index-RfzFmWyn.js";import"./index-C2AIlcfF.js";import"./index-BH0NSEIh.js";function B({auth:m,audit:a,ratings:j=[],stores:v=[]}){if(!a)return e.jsxs(b,{user:m.user,children:[e.jsx(h,{title:"Edit Camera Form"}),e.jsx("div",{className:"flex flex-1 flex-col gap-4 p-4 pt-0",children:e.jsx("div",{className:"rounded-lg border bg-card p-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})})})]});const[l,u]=n.useState({}),[x,N]=n.useState(a.store_id?.toString()||""),[p,y]=n.useState(()=>a.date?new Date(a.date).toISOString().split("T")[0]:""),[g,o]=n.useState(!1),[d,S]=n.useState({}),c=a.camera_forms?.map(s=>s.entity).filter(Boolean);n.useEffect(()=>{const s={};a.camera_forms?.forEach(r=>{s[r.entity_id]={entity_id:r.entity_id,rating_id:r.rating_id||null,note:r.note||""}}),u(s)},[a.camera_forms]);const E=s=>{s.preventDefault(),o(!0);const r=Object.values(l).filter(t=>t.rating_id||t.note);D.put(`/camera-forms/${a.id}`,{store_id:x,date:p,entities:r},{preserveScroll:!0,onSuccess:()=>{o(!1)},onError:t=>{S(t),o(!1)}})},f=(s,r,t)=>{u(i=>({...i,[s]:{...i[s],[r]:t}}))},k=c.reduce((s,r)=>{const t=r.category?.label||"Uncategorized";return s[t]||(s[t]=[]),s[t].push(r),s},{});return e.jsxs(b,{user:m.user,children:[e.jsx(h,{title:"Edit Camera Form"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 pt-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Camera Form"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Update inspection values for this camera form"})]}),e.jsx("a",{href:"/camera-forms",className:"text-sm font-medium text-muted-foreground hover:text-foreground",children:"â† Back"})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border bg-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Store ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("select",{value:x,onChange:s=>N(s.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",required:!0,children:[e.jsx("option",{value:"",children:"Select Store"}),v.map(s=>e.jsx("option",{value:s.id,children:s.store},s.id))]}),d.store_id&&e.jsx("p",{className:"text-sm text-destructive",children:d.store_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Date ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("input",{type:"date",value:p,onChange:s=>y(s.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",required:!0}),d.date&&e.jsx("p",{className:"text-sm text-destructive",children:d.date})]})]})]}),e.jsx("div",{className:"rounded-lg border bg-accent/30 p-4",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Editing ",c.length," entities from this audit. Update their ratings and notes below."]})}),e.jsx("div",{className:"space-y-4",children:Object.entries(k).map(([s,r])=>e.jsxs("div",{className:"rounded-lg border bg-card",children:[e.jsx("div",{className:"border-b bg-muted/50 px-6 py-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:s})}),e.jsx("div",{className:"p-6 space-y-4",children:r.map(t=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 rounded-md bg-muted/20",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("label",{className:"text-sm font-medium",children:t.entity_label})}),e.jsx("div",{className:"space-y-1",children:e.jsxs("select",{value:l[t.id]?.rating_id||"",onChange:i=>f(t.id,"rating_id",i.target.value?Number(i.target.value):null),className:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx("option",{value:"",children:"Select Rating"}),j.map(i=>e.jsx("option",{value:i.id,children:i.label},i.id))]})}),e.jsx("div",{className:"space-y-1",children:e.jsx("input",{type:"text",placeholder:"Note (optional)",value:l[t.id]?.note||"",onChange:i=>f(t.id,"note",i.target.value),className:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})})]},t.id))})]},s))}),c.length===0&&e.jsx("div",{className:"rounded-lg border bg-card p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No entities found for this audit."})}),d.entities&&e.jsx("p",{className:"text-sm text-destructive",children:d.entities}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t",children:[e.jsx("a",{href:"/camera-forms",className:"inline-flex items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow hover:bg-primary/90 disabled:opacity-50",children:g?"Updating...":"Update Form"})]})]})]})]})}export{B as default};
